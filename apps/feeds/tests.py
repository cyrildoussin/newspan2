# -*- encoding: utf-8 -*-
from django.test import TestCase
from django.utils import timezone
from apps.feeds.models import *


class ArticleParsing(TestCase):
    def test_1(self):
        a = Article(
            published=timezone.now(),
            guid='fish',
            as_json=u"""{"updated": "2013-01-03T23:25:00+00:00", "links": [{"href": "http://dev.nsfwcorp.com:5000/dispatch/congress-cliches/", "type": "text/html", "rel": "alternate"}], "title": "Dear New Congress: Please Kill These Clich\u00e9s", "author_detail": {"href": "https://www.nsfwcorp.com/author/james-kotecki/", "name": "James Kotecki"}, "rights": "\u00a9 Not Safe For Work Corporation", "summary_detail": {"base": "", "type": "text/html", "value": "<p>It\u2019s the first day of the 113th Congress, and new members are being sworn in to what will surely be another historic* two years of legislative thrills, spills and chills. It\u2019s hard to imagine it being any worse than the 112th Congress, but our legislative branch really excels at  pushing the awfulness envelope. </p>", "language": "en-us"}, "summary": "<p>It\u2019s the first day of the 113th Congress, and new members are being sworn in to what will surely be another historic* two years of legislative thrills, spills and chills. It\u2019s hard to imagine it being any worse than the 112th Congress, but our legislative branch really excels at  pushing the awfulness envelope. </p><blockquote><p>As a former House page who sat through numerous floor debates, I\u2019d like to make one request of the incoming freshmen: please, please avoid the following clich\u00e9s.</p></blockquote>", "content": [{"base": "", "type": "text/html", "value": "<p>It\u2019s the first day of the 113th Congress, and new members are being sworn in to what will surely be another historic* two years of legislative thrills, spills and chills. It\u2019s hard to imagine it being any worse than the 112th Congress, but our legislative branch really excels at  pushing the awfulness envelope. </p><blockquote><p>As a former House page who sat through numerous floor debates, I\u2019d like to make one request of the incoming freshmen: please, please avoid the following clich\u00e9s.</p></blockquote><p>Bounce, bounce.</p><ul><li>fuck</li><li>yeah</li></ul><p><b>\u201cMy Good Friend On the Other Side of the Aisle\u201d</b></p><ol><li>that guy's not your friend</li><li>I'm not your friend</li><li>your wife is my friend</li></ol><p>Yeah, that guy\u2019s probably not your friend. To quote Ocean\u2019s 11, \u201cwho you calling friend, jackass?\u201d</p><p>Have Facebook and John McCain taught us nothing? If everyone is your friend, then nobody is.</p><p><b>\u201cSpecial Interests\u201d</b></p><p>What\u2019s so \u201cspecial\u201d about an interest group? DC is swarming with them, many of which probably support you. \u201cSpecial\u201d interests are just those that you oppose. </p><p><b>\u201cTax Loopholes\u201d</b></p><p>\u201cLoophole\u201d implies some kind of oversight or accident, but a lot of lobbyists probably worked really hard on that loophole! Give them some credit. Also, what you call a loophole, some other lawmakers might even call an essential job-creating incentive for a critical industry that faces unfair competition unless Congress uses the tax code to level the playing field. (Those same lawmakers might also say, more quietly, \u201cthanks for the campaign contributions, industry I just helped!\u201d)</p><p><b>\u201cThe American People Are Smart Enough to Know [Your View Here]\u201d</b></p><p>If the American people are so smart, why did they elect so many people who disagree with the exact thing you say they know?</p><p><b>\u201cThe American People Want [Your View Here]\u201d</b></p><p>Again, if the American people want it so badly, why did they elect so many people who don\u2019t want what you say they do? Also, isn\u2019t it curious that you always want what the American people want, but none of your opponents ever do?</p><p><b>\u201cThis Issue Shouldn\u2019t Be About Petty/Partisan/Party Politics\u201d</b></p><p>Maybe not, but it totally is.</p><p>*Because every Congress is historic, it being Congress and all.</p>", "language": "en-us"}], "guidislink": false, "title_detail": {"base": "", "type": "text/plain", "value": "Dear New Congress: Please Kill These Clich\u00e9s", "language": "en-us"}, "href": "https://www.nsfwcorp.com/author/james-kotecki/", "link": "http://dev.nsfwcorp.com:5000/dispatch/congress-cliches/", "author": "James Kotecki", "authors": [{"href": "https://www.nsfwcorp.com/author/james-kotecki/", "name": "James Kotecki"}], "rights_detail": {"base": "", "type": "text/plain", "value": "\u00a9 Not Safe For Work Corporation", "language": "en-us"}, "id": "http://dev.nsfwcorp.com:5000/dispatch/congress-cliches/"}""",
        )

        self.assertEqual(u"Dear New Congress: Please Kill These Clich√©s", a.title())
        authors = a.authors()
        self.assertEqual(1, len(authors))
        self.assertEqual("James Kotecki", authors[0]['name'])
        self.assertEqual("https://www.nsfwcorp.com/author/james-kotecki/", authors[0]['href'])
        content = a.body()
        self.assertTrue('text/html', content['type'])
        self.assertNotEqual(a.entry['summary'], content['value'])
